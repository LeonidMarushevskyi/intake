#!/bin/bash

# Removes all ANSI colors codes, takes input via stdin.
remove_color_codes() {
  perl -pe 's/\x1b\[[0-9;]*m//g'
}

# Changes "light black" colors so they are not hidden with Solarized Dark
# Note that, as is true with all shell pipelines, this cannot return the exit
# status of the piped-from command. See instead unblacken_cmd().
#
# See <https://github.com/altercation/solarized/pull/240>
# See <https://github.com/mochajs/mocha/issues/802#issuecomment-18254298>
unblacken() {
  if [ -t 1 ]; then
    perl -pe 's/\x1b\[90m/\x1b[92m/g'
  else
    remove_color_codes
  fi
}

# Like unblacken(), but takes the command to unblacken as an argument list and
# returns the exit status of the command run.
unblacken_cmd() {
  set -o pipefail
  $@ | unblacken
}
